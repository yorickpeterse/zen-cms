<section>
    <header>
        <h1>#{get_breadcrumbs}</h1>
    </header>

    <?r if !@user.id.nil? ?>
    <div class="tabs">
        <ul>
            <li>
                <a href="#user_tab" title="#{lang('users.titles.edit')}">
                    #{lang('users.titles.edit')}
                </a>
            </li>

            <?r if user_authorized?(:show_permission) ?>
            <li>
                <a href="#permissions"
                title="#{lang('permissions.titles.index')}">
                    #{lang('permissions.titles.index')}
                </a>
            </li>
            <?r end ?>
        </ul>
    </div>
    <?r end ?>

    #{form_for(
      @user,
      :method => :post,
      :action => Users::Controller::Users.r(:save),
      :id     => :user_form
    ) do |f|
      f.input_hidden(:csrf_token, get_csrf_token)
      f.input_hidden(:id, @user.id)

      f.g.div(:id => 'user_tab') do
        f.input_text(
          lang('users.labels.name'),
          :name,
          :required  => :required,
          :maxlength => 255
        )

        f.input_text(
          lang('users.labels.email'),
          :email,
          :required  => :required,
          :maxlength => 255,
          :pattern   => Users::Model::User::EMAIL_REGEX
        )

        f.input_text(
          lang('users.labels.website'),
          :website,
          :maxlength => 255
        )

        f.input_password(
          lang('users.labels.password'),
          :password,
          :value => ''
        )

        f.input_password(
          lang('users.labels.confirm_password'),
          :confirm_password
        )

        f.select(
          lang('users.labels.status'),
          :user_status_id,
          :values   => Users::Model::UserStatus.dropdown,
          :selected => @user.user_status_id,
          :size     => 1
        )

        f.input_checkbox(
          lang('users.labels.user_groups'),
          :user_group_pks,
          @user.user_group_pks,
          :values => @user_group_pks,
        )

        f.select(
          lang('users.labels.language'),
          :language,
          :values   => ::Zen::Language::LANGUAGES,
          :selected => @user.language,
          :size     => 1
        )

        f.select(
          lang('users.labels.frontend_language'),
          :frontend_language,
          :values   => ::Zen::Language::LANGUAGES,
          :selected => @user.frontend_language,
          :size     => 1
        )

        f.select(
          lang('users.labels.date_format'),
          :date_format,
          :values   => get_setting(:date_format).values,
          :selected => @user.date_format,
          :size     => 1
        )
      end

      if user_authorized?(:show_permission)
        f.g.div(:id => 'permissions') do
          render_view(:permissions)
        end
      end

      f.g.div(:class => 'button') do
        f.g.input(:type => 'submit', :value => lang('users.buttons.save'))
      end
    end}
</section>
