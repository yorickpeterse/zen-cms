<article>
    <header>
        <h1>#{get_breadcrumbs}</h1>
    </header>

    <div class="tabs">
        <ul>
            <li>
                <a href="#basic" title="#{lang('section_entries.tabs.basic')}">
                    #{lang('section_entries.tabs.basic')}
                </a>
            </li>
            <li>
                <a href="#categories" 
                title="#{lang('section_entries.tabs.categories')}">
                    #{lang('section_entries.tabs.categories')}
                </a>
            </li>

            <?r @custom_fields_hash.each do |id, group| ?>
            <li>
                <a href="#group_#{id}" title="#{group[:name]}">
                  #{group[:name]}
                </a>
            </li>
            <?r end ?>
        </ul>
    </div>

    #{
      form_for(
        @entry, 
        :method => :post, 
        :action => Sections::Controller::SectionEntries.r(:save), 
        :id     => :section_entry_form
      ) do |f|
        f.input_hidden(:csrf_token, get_csrf_token)
        f.input_hidden(:section_id, @section_id)
        f.input_hidden(:id        , @entry.id)
        
        f.g.div(:id => :basic) do
          f.input_text(
            lang('section_entries.labels.title'), 
            :title
          )

          f.input_text(
            lang('section_entries.labels.slug'), 
            :slug
          )

          # Only show the date field when modifying an existing entry
          if !@entry.nil?
            f.input_text(
              lang('section_entries.labels.created_at'),
              :created_at,
              :class => 'date'
            )
          end
        
          f.select(
            lang('section_entries.labels.author'), 
            :user_id, 
            :values => ::Users::Model::User.pk_hash(:name)
          )
          
          f.select(
            lang('section_entries.labels.status'), 
            :section_entry_status_id, 
            :values   => ::Sections::Model::SectionEntry.status_hash,
            :selected => @entry.section_entry_status_id, 
            :size     => 1
          )
        end
        
        f.g.div(:id => :categories) do
          if !@possible_categories.empty?
            @possible_categories.each do |group, categories|
              f.select(
                group, 
                :category_pks, 
                :values   => categories, 
                :multiple => :multiple,
                :selected => @entry.category_pks
              )
            end
          else
            f.g.p(lang('section_entries.messages.no_categories'))
          end
        end

        # Display all the custom fields for this entry
        @custom_fields_hash.each do |id, group|
          f.g.div(:id => "group_#{id}") do
            group[:fields].each do |field|
              f.send(*field)
            end
          end
        end

        f.g.div(:class => 'button') do
          f.g.input(
            :type  => 'submit', 
            :value => lang('section_entries.buttons.save')
          )
        end
      end
      }
</article>
